---
title: "Akram_Regression"
output: html_notebook
---

Load packages:

```{r}

library(ggplot2)
library(tidyr)
library(dplyr)
library(patchwork)
library(lubridate)
library(zoo)
library(Hmisc)
library(ggcorrplot)
library(corrplot)
library(ggpubr)
library(caret)
library(car)
library(glmnet)

path = "~/Desktop/NYCDSA/Homework/Project3/Akram/2 - Regression Models"
setwd(path)

```


Import data:

```{r}

df_engineered = read.csv("~/Desktop/NYCDSA/Homework/Project3/Akram/1 - EDA/df_engineered.csv", stringsAsFactors = TRUE)

head(df_engineered)

```

Engineer a custom dataframe with best features:

```{r}

df_akram = select(df_engineered, c(PID, logSalePrice, GrLivArea, LotArea, Neighborhood_Int, Age, StreetAlley, RemodSinceBuilt, LotShape, LandContour, LandSlope, LotConfig, IsOnMainroad, IsNearPark, IsNearRailroad, BsmtQual, RoofStyle, OverallQual, OverallCond, ExterQual, Exterior1st, Exterior2nd, BsmtExposure, Rate, BldgType, MSZoning, Foundation, TotalBsmtSF, Heating, KitchenQual, Fireplaces, GarageType, GarageQual, GarageCond, GarageFinish, GarageCars, KitchenAbvGr, PavedDrive, EnclosedPorch, SaleCondition, ScreenPorch, HouseStyle, BsmtFullBath, AllBathrooms, FullBath, FireplaceQu, Functional, TotRmsAbvGrd, BedroomAbvGr, HeatingQC, CentralAir))

#MSSubClass
#SaleType
#RoofMatl

```


Linear regression model:

```{r}

set.seed(100)

df_sample = createDataPartition(df_akram$PID, p=0.7, list=FALSE)

train_set = df_akram[df_sample, ]
test_set = df_akram[-df_sample, ]

Linear_Model = lm(logSalePrice ~
                    GrLivArea + LotArea +
                    Neighborhood_Int + Age +
                    StreetAlley + RemodSinceBuilt +
                    LotShape + LandContour +
                    LandSlope + LotConfig +
                    IsOnMainroad + IsNearPark +
                    IsNearRailroad + BsmtQual +
                    RoofStyle +
                    OverallQual + OverallCond +
                    ExterQual + Exterior1st +
                    BsmtExposure + Rate +
                    BldgType + MSZoning +
                    Foundation + TotalBsmtSF +
                    Heating + KitchenQual +
                    Fireplaces + GarageFinish +
                    GarageQual + GarageCond +
                    GarageCars + KitchenAbvGr +
                    PavedDrive + EnclosedPorch +
                    SaleCondition + ScreenPorch +
                    HouseStyle + BsmtFullBath +
                    AllBathrooms + FullBath +
                    FireplaceQu + Functional +
                    TotRmsAbvGrd + BedroomAbvGr +
                    HeatingQC + CentralAir,
                  data = train_set)

# + MSSubClass + SaleType + RoofMatl
# + GarageType + Exterior2nd +

summary(Linear_Model)

R2_Train = summary(Linear_Model)$adj.r.squared

R2_Train

Linear_Model_Prediction = predict(Linear_Model, test_set)

R2_Test = R2(Linear_Model_Prediction, test_set$logSalePrice)
RMSE_Test = RMSE(Linear_Model_Prediction, test_set$logSalePrice)
MAE_Test = MAE(Linear_Model_Prediction, test_set$logSalePrice)

R2_Test
RMSE_Test
MAE_Test

GVIF = vif(Linear_Model)

GVIF

Max_GVIF = which(GVIF == max(GVIF))

df_eng_temp = select(df_akram, -PID)

model.matrix(~0+., data=df_eng_temp) %>% 
  #cor(use="complete.obs") %>% 
  cor(use="pairwise.complete.obs") %>% 
  ggcorrplot(show.diag = F, type="lower", lab=FALSE, lab_size=2, tl.cex=2, tl.srt=90)

ggsave("corr.pdf")

corr_matrix = model.matrix(~0+., data=df_eng_temp) %>% 
  #cor(use="complete.obs") %>% 
  cor(use="pairwise.complete.obs")

which(corr_matrix > 0.9 & corr_matrix !=1, arr.ind=T )

```


Linear model results summary:

```{r}

sink("Linear_Model_Results.txt")
cat(paste("Ames Linear Regression Model Results:"),
    paste("R^2 Training = ", R2_Train), 
    paste("R^2 Test = ", R2_Test), 
    paste("RMSE Test = ", RMSE_Test), 
    paste("GVIF Max = ", Max_GVIF), sep="\n")
sink()

cat(paste("Ames Linear Regression Model Results:"),
    paste("R^2 Training = ", R2_Train), 
    paste("R^2 Test = ", R2_Test), 
    paste("RMSE Test = ", RMSE_Test), 
    paste("GVIF Max = ", Max_GVIF), sep="\n")


```


Elastic-Net Regression Model:

```{r}




```

